# UE插件智能清理工具 v3.0

一个专为Unreal Engine插件设计的智能清理工具，可以安全地删除PDB等调试文件和中间文件，减少插件体积，不影响正常使用。

## 🆕 v3.0 新功能

- 🎉 **支持压缩包直接清理** - 拖拽 `.zip` 文件自动解压、清理、重新打包
- 🗑️ **直接删除Source文件夹** - 可选择删除整个Source源码目录
- 📁 **批量处理** - 同时处理多个文件/压缩包
- 📊 **进度条显示** - 实时显示扫描、删除、打包进度
- 🛠️ **优化临时目录位置** - 使用脚本同目录，避免C盘权限问题
- 📝 **处理摘要报告** - 显示成功/失败数量和详细结果

## 功能特性

- ✅ 自动检测UE插件结构（.uplugin文件和标准目录）
- ✅ 智能清理多种冗余文件
- ✅ 支持拖拽文件夹和压缩包操作
- ✅ 预览模式：一屏显示所有将要删除的内容
- ✅ 交互式确认机制
- ✅ 详细的清理报告
- ✅ 安全设计：只删除不影响使用的文件
- ✅ 准确的文件大小计算，避免重复统计

## 清理内容

### 完整删除的目录
- `Source/` - 整个源码目录（v3.0新增）
- `Intermediate/` - UE中间文件
- `DerivedDataCache/` - 派生数据缓存
- `.vs/` - Visual Studio缓存
- `__pycache__/` - Python缓存

### 清理的文件类型
- `.pdb` - 程序调试符号（通常最大）
- `.ilk` - 增量链接文件
- `.obj` - 对象文件
- `.log` - 日志文件
- `.idb`, `.tlog`, `.recipe` - 编译临时文件
- `.DS_Store` - Mac系统文件
- `.bak`, `.tmp` - 备份和临时文件

### Binaries目录特殊处理
在Binaries目录下：
- **保留**: `.dll`, `.so`, `.dylib`, `.modules` 等必需文件
- **删除**: `.pdb` 等调试符号文件

## 使用方法

### 方法1: 拖拽使用（最简单）

1. 将插件文件夹或压缩包拖到 `clean_ue_plugin.bat`
2. 查看预览内容
3. 输入 `y` 确认删除

### 方法2: 命令行使用

```bash
# 清理指定插件目录
python ue_plugin_cleaner.py "C:\Path\To\YourPlugin"

# 清理压缩包（自动解压-清理-重新打包）
python ue_plugin_cleaner.py plugin.zip

# 批量处理多个文件/目录
python ue_plugin_cleaner.py plugin1.zip plugin2.zip directory1 directory2

# 批量模式（自动确认所有操作）
python ue_plugin_cleaner.py *.zip --batch

# 显示处理摘要
python ue_plugin_cleaner.py *.zip --summary

# 详细输出模式
python ue_plugin_cleaner.py "C:\Path\To\YourPlugin" -v
```

## ⚠️ 临时目录和权限说明

### 临时目录位置
- **v3.0 及以后**: 临时目录位于脚本同目录下（例如：`脚本目录/temp_时间戳_进程ID/`）
- **v2.x 及以前**: 使用系统临时目录（C:\Users\xxx\AppData\Local\Temp\）
- 临时目录会在处理完成后自动清理

### 权限问题解决
如果遇到权限错误，尝试：
1. **以管理员身份运行**命令行或批处理文件
2. **关闭占用文件的程序**（如UE编辑器、文件管理器）
3. **临时移动压缩包**到脚本同目录再处理
4. **检查目标路径**是否可写

### 批量处理建议
- 处理多个压缩包时，建议先以**管理员身份**运行
- 大量文件时建议使用 `--batch` 参数自动确认
- 查看处理摘要使用 `--summary` 参数

## 使用示例

1. 将 `clean_ue_plugin.bat` 复制到UE插件目录内
2. 双击运行批处理文件
3. 查看预览内容，确认无误后输入 `y` 并回车
4. 等待清理完成

## 使用示例

### 示例1: 预览将要删除什么

```bash
python ue_plugin_cleaner.py "C:\MyPlugin"
```

输出示例：
```
插件清理预览: MyPlugin
==================================================

将删除目录分类:
  📁 编译缓存: 1 个目录, 778.68 MB

主要目录结构:
  └─ Intermediate/ (778.68 MB)
      └─ Build/ (778.68 MB)

将删除的文件类型统计:
  📄 .pdb - 11 个文件, 614.74 MB

最大的文件 (显示前5个):
  📄 Binaries\Win64\UnrealEditor-X_AssetEditor.pdb - 66.14 MB
  📄 Binaries\Win64\UnrealEditor-SortEditor.pdb - 58.68 MB
  📄 Binaries\Win64\UnrealEditor-ObjectPool.pdb - 57.14 MB
  📄 Binaries\Win64\UnrealEditor-FormationSystem.pdb - 56.43 MB
  📄 .../Win64\UnrealEditor-ComponentTimelineUncooked.pdb - 55.61 MB

--------------------------------------------------
总计将删除: 90 个目录, 557 个文件
预计释放空间: 1.36 GB
--------------------------------------------------

⚠️  警告: 此操作将永久删除上述文件和目录!
确认删除? (y/N):
```

## 安全说明

### ✅ 安全删除
- 调试符号文件（.pdb）- 仅用于调试，发布不需要
- 中间编译文件 - 可以重新生成
- IDE缓存文件 - 不影响运行
- 日志和临时文件 - 不影响功能

### ❌ 保留的重要文件
- `.dll`, `.so`, `.dylib` - 运行时必需的动态库
- `.uplugin` - 插件描述文件
- `.modules` - UE模块信息
- `Content/` - 资源文件
- `Source/` - 源代码

## 典型效果

一个中型UE插件清理前后对比：

| 项目 | 清理前 | 清理后 | 节省 |
|------|--------|--------|------|
| 体积 | 856 MB | 234 MB | 72.7% |
| 文件数 | 3,241 | 1,156 | 2,085个 |

常见清理效果：
- 小型插件: 节省 50-100 MB
- 中型插件: 节省 200-500 MB
- 大型插件: 节省 500 MB - 2 GB

## 常见问题

### Q: 清理后插件还能正常使用吗？
A: 可以。工具只删除调试符号和中间文件，不影响插件运行。

### Q: 可以恢复删除的文件吗？
A: PDB等文件可以通过重新编译项目恢复。建议先查看预览内容再确认。

### Q: 如果误删了文件怎么办？
A: 可以通过版本控制系统恢复，或者重新编译项目生成中间文件。

### Q: 适用于哪些UE版本？
A: 适用于UE4和UE5的所有版本。

### Q: 可以清理整个项目吗？
A: 可以，但建议只清理打包发布的版本。开发版本建议保留调试文件。

### Q: 清理后源代码还在吗？
A: 在。工具不会删除Source目录下的源代码文件。

### Q: 为什么工具显示的大小与实际目录大小不同？
A: 工具只计算将要删除的文件和目录大小，而不是整个插件目录的大小。例如，XTools目录总大小为1.47GB，但工具只删除其中的1.36GB（编译缓存和调试文件）。

## 命令行参数

```
positional arguments:
  path              插件路径（默认为当前目录）

optional arguments:
  -h, --help        显示帮助信息
  -v, --verbose     详细输出每个删除的文件
```

## 注意事项

1. **首次使用建议**：仔细查看预览内容，确认无误后再输入 `y` 确认
2. **重要项目**：建议先备份或使用版本控制
3. **开发中的项目**：可能需要保留.pdb用于调试
4. **发布版本**：强烈建议清理以减小体积

## 系统要求

- Python 3.6+
- Windows / macOS / Linux
- 无需额外依赖库（仅使用标准库）

## 技术细节

工具会检测以下特征来识别UE插件：
- `.uplugin` 文件的存在
- `Source`, `Content`, `Binaries`, `Resources` 等标准目录

识别到插件后，会：
1. 预览将要删除的内容（按大小排序，一屏显示）
2. 等待用户确认
3. 完整删除 Intermediate、.vs 等缓存目录
4. 递归扫描所有文件
5. 根据扩展名和位置判断是否可以删除
6. 在Binaries目录特别保护.dll等必需文件
7. 准确计算文件和目录大小，避免重复统计

## License

MIT License - 自由使用和修改

## 更新日志

### v2.0 (2025-01-11)
- 重新设计用户界面，简化批处理文件
- 添加预览模式，一屏显示所有将要删除的内容
- 添加交互式确认机制
- 优化文件显示，按大小排序
- 删除执行模式批处理，统一为一个入口
- 修复目录大小计算问题，避免重复统计
- 改进文件分类显示，更直观地展示清理内容

### v1.0 (2025-01-11)
- 初始版本
- 支持UE插件自动检测
- 智能清理PDB和中间文件
- 拖拽支持
- 预览和执行双模式