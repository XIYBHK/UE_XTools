# XTools 插件设置使用指南

## 📍 访问插件设置

在Unreal Editor中：
```
编辑 -> 项目设置 -> 插件 -> XTools
```

---

## 🎛️ 模块开关

### **对象池子系统**
- **设置名称**: `启用对象池子系统`
- **默认状态**: ❌ 关闭
- **功能说明**: 提供高性能的Actor对象池，减少频繁创建/销毁的开销
- **适用场景**: 
  - ✅ 射击游戏（大量子弹、特效）
  - ✅ 弹幕游戏（海量粒子）
  - ✅ 塔防游戏（频繁生成敌人）
  - ❌ 策略游戏（Actor生成不频繁）
  - ❌ 剧情游戏（无大量重复Actor）

**性能影响**:
- 启用后会在游戏开始时分帧预热对象池
- 占用少量内存存储池化Actor
- 运行时Spawn/Return几乎零开销

### **增强代码流子系统 (EnhancedCodeFlow)**
- **设置名称**: `启用增强代码流子系统`
- **默认状态**: ❌ 关闭
- **功能说明**: 提供高级异步执行、协程、延迟任务等代码流控制
- **适用场景**:
  - ✅ 需要复杂异步逻辑的项目
  - ✅ 需要协程功能
  - ✅ 需要精细控制执行流程
  - ❌ 简单项目（用蓝图Timer即可）

**性能影响**:
- 启用后常驻一个子系统
- 占用少量内存（<1MB）
- Tick开销可忽略（仅在有任务时）

### **阵型系统**
- **设置名称**: `启用阵型系统`
- **默认状态**: ✅ 开启
- **功能说明**: 提供各种阵型算法和管理组件
- **适用场景**:
  - ✅ RTS游戏
  - ✅ 策略游戏
  - ✅ MOBA游戏
  - ❌ 单人射击游戏
  - ❌ 解谜游戏

**性能影响**:
- 仅在使用阵型功能时有开销
- 不使用时无性能影响

### **组件时间轴**
- **设置名称**: `启用组件时间轴`
- **默认状态**: ✅ 开启
- **功能说明**: 为组件提供时间轴动画功能
- **适用场景**:
  - ✅ 需要组件动画的项目
  - ✅ UI动画
  - ✅ 程序化动画
  - ❌ 纯静态场景

**性能影响**:
- 仅在使用时有开销
- 不使用时无性能影响

---

## ⚙️ 性能优化选项

### **对象池配置**

#### **每帧最大预热数量**
- **设置名称**: `对象池每帧最大预热数量`
- **默认值**: 10
- **推荐值**:
  - `10` - 流畅优先（默认，推荐）
  - `30` - 平衡模式
  - `50` - 快速预热（可能有轻微卡顿）
  - `100+` - 极速预热（明显卡顿，仅用于测试）

**计算预热时间**:
```
预热时间 = 总Actor数量 / 每帧数量 / 帧率

示例1（默认）:
  100个Actor / 10个/帧 / 60fps = 0.17秒

示例2（平衡）:
  100个Actor / 30个/帧 / 60fps = 0.06秒

示例3（快速）:
  100个Actor / 50个/帧 / 60fps = 0.03秒
```

#### **默认池初始大小**
- **设置名称**: `对象池默认初始大小`
- **默认值**: 10
- **说明**: 注册新池时的默认预热数量
- **建议**: 
  - 小型Actor（子弹、特效）: 20-50
  - 中型Actor（敌人）: 10-20
  - 大型Actor（Boss）: 1-5

#### **默认池最大大小**
- **设置名称**: `对象池默认最大大小`
- **默认值**: 100
- **说明**: 池的默认最大限制（0=无限制）
- **建议**:
  - 移动平台: 50-100
  - PC平台: 100-500
  - 内存充足: 0（无限制）

---

## 🐛 调试选项

### **启用详细日志**
- **设置名称**: `启用详细日志`
- **默认状态**: ❌ 关闭
- **功能**: 输出各模块的详细运行信息
- **性能影响**: 大量日志输出会降低性能
- **使用场景**: 仅在调试时启用

### **对象池统计**
- **设置名称**: `对象池启用统计`
- **默认状态**: ✅ 开启
- **功能**: 收集对象池的使用统计信息
- **性能影响**: 极小（仅计数器）
- **使用场景**: 建议保持开启，方便监控池使用情况

---

## 📊 推荐配置方案

### **方案1：高性能射击游戏**
```
✅ 启用对象池子系统
  • 每帧预热数量: 30
  • 默认初始大小: 50
  • 默认最大大小: 200

❌ 启用增强代码流子系统（用不到）
✅ 启用阵型系统（可能需要）
✅ 启用组件时间轴
✅ 对象池统计
❌ 详细日志
```

### **方案2：RTS策略游戏**
```
❌ 启用对象池子系统（生成不频繁）

✅ 启用增强代码流子系统
✅ 启用阵型系统
✅ 启用组件时间轴
❌ 对象池统计
❌ 详细日志
```

### **方案3：休闲解谜游戏**
```
❌ 启用对象池子系统
❌ 启用增强代码流子系统
❌ 启用阵型系统
✅ 启用组件时间轴
❌ 对象池统计
❌ 详细日志
```

### **方案4：移动平台游戏**
```
✅ 启用对象池子系统
  • 每帧预热数量: 10（流畅优先）
  • 默认初始大小: 20
  • 默认最大大小: 50（限制内存）

❌ 启用增强代码流子系统
❌ 启用阵型系统
✅ 启用组件时间轴
✅ 对象池统计
❌ 详细日志
```

---

## 🔧 在代码中访问设置

### **C++ 代码**
```cpp
#include "XToolsSettings.h"

// 读取设置
const UXToolsSettings* Settings = UXToolsSettings::Get();
if (Settings->bEnableObjectPoolSubsystem)
{
    // 对象池已启用
    int32 MaxPrewarm = Settings->ObjectPoolMaxPrewarmPerFrame;
}

// 修改设置（仅编辑器）
UXToolsSettings* MutableSettings = UXToolsSettings::GetMutable();
MutableSettings->ObjectPoolMaxPrewarmPerFrame = 20;
MutableSettings->SaveConfig();
```

### **蓝图访问**
目前设置类主要供C++使用，蓝图可通过以下方式间接访问：
- 对象池：通过 `Get对象池子系统` 节点，如果返回null说明未启用
- 增强代码流：通过 `GetECFSubsystem` 节点检查

---

## ❓ 常见问题

### **Q: 修改设置后需要重启编辑器吗？**
A: 大部分设置需要重启才能生效（特别是子系统开关）。性能参数（如预热数量）可能可以动态生效。

### **Q: 如何重置到默认设置？**
A: 删除项目的 `Config/DefaultGame.ini` 中的 `[/Script/XTools.XToolsSettings]` 部分。

### **Q: 多人游戏中设置如何同步？**
A: 插件设置是项目级配置，不会在多人游戏中同步。服务器和客户端各自使用自己的配置。

### **Q: 打包后设置文件在哪？**
A: 打包后的配置在 `YourGame/Saved/Config/[Platform]/Game.ini`

---

## 📝 最佳实践

1. **开发阶段**: 
   - 启用详细日志
   - 启用所有统计信息
   - 使用较小的预热数量（方便快速迭代）

2. **测试阶段**:
   - 关闭详细日志
   - 保持统计信息
   - 调整预热数量找平衡点

3. **发布版本**:
   - 关闭详细日志
   - 关闭统计信息（或保留用于遥测）
   - 使用优化后的配置值

4. **内存受限平台**:
   - 减小默认池大小
   - 设置池最大限制
   - 关闭不需要的子系统

5. **性能敏感场景**:
   - 预先预热对象池
   - 使用较大的预热数量（减少预热帧数）
   - 关闭不必要的日志和统计

---

## 🎯 总结

- ✅ **默认配置已优化**，大多数项目无需修改
- ✅ **按需启用功能**，避免不必要的开销
- ✅ **性能优先原则**，移动平台应保守配置
- ✅ **测试验证配置**，找到最适合项目的设置

有问题请查看插件文档或提交Issue！

